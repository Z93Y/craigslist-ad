function displayInPopup(e,t,n){var o,r=document.getElementById("popupOverlay"),d=(r&&(r.innerHTML=""),(r=r||document.createElement("div")).id="popupOverlay",r.close=function(e){document.body.removeChild(r),delete r,n&&!e&&n()},document.body.insertBefore(r,document.body.firstChild),r.addEventListener("click",r.close),makeE("fieldset","popUp")),t=(d.addEventListener("click",function(e){e.stopPropagation()}),"object"==typeof t&&t.className&&"DIV"==t.nodeName?(t.classList.add("popup-title"),o=t):((o=document.createElement("div")).setAttribute("class","popup-title"),t||o.classList.add("empty"),o.innerText=t||""),d.appendChild(o),document.createElement("div"));return t.setAttribute("class","close-x"),t.innerHTML="Ã—",t.addEventListener("click",r.close),d.appendChild(t),e&&d.appendChild(e),r.appendChild(d),r}function makeE(e,t,n){e=document.createElement(e);return e.className=t,e.innerText=textDivOrStr(n,n),e}function textDivOrStr(e,t){var n;return(n=document.getElementById(e)?document.getElementById(e).innerText:n)||t||""}function doAutorepostDialog(d,i){var e=document.createElement("div"),t=(d.checked&&((n=document.querySelector("#autorepost-"+i).cloneNode(1)).classList.remove("hidden"),n.classList.add("details"),t=n.querySelector("time"),n.insertBefore(makeE("br"),t),e.appendChild(n)),makeE("div","purple-buttons")),n=makeE("button","affirm-button",d.checked?"enableText":"disableText"),o=(n.setAttribute("type","button"),makeE("button","cancel-button","nevermindText")),n=(o.setAttribute("type","button"),e.appendChild(t),t.appendChild(n),t.appendChild(o),makeE("div","popup-title",d.checked?"enableConfirm":"disableConfirm")),t=document.getElementById("autorepost-questions"),s=(t&&((o=t.cloneNode(1)).classList.remove("hidden"),n.appendChild(o)),displayInPopup(e,n,function(){d.checked=!d.checked}));s.querySelector(".affirm-button").addEventListener("click",function(e){var t=new URL(document.location).searchParams,n=t.get("lang")||"en",t=t.get("cc")||"en",o=autorepostOnOffUrl(i),r=new FormData;r.append("enabled",1==d.checked?"1":"0"),r.append("cc",t),r.append("lang",n);doAutorepostRequest("POST",function(e){var t,n,o;this.response&&(t=document.querySelector("fieldset.popUp"),n=makeE("div"),t&&(t.innerHTML=""),0<this.response.errors.length?((n=document.getElementById("general-error-text").cloneNode(1)).classList.remove("hidden"),this.response.errors.forEach(function(e){console.log(e.message)})):this.response.data.items[0]?(o=this.response.data.items[0].successMessage,n.innerText=o,setTimeout(function(){s.close(!0)},3e3)):((n=document.getElementById("general-error-text")).classList.remove("hidden"),console.log("no errors or items found")),n.classList.add("popup-title"),t.appendChild(n))},o,r)}),s.querySelector(".cancel-button").addEventListener("click",function(e){s.close()})}function doAutorepostRequest(d,t,n,e){var i=0;!function o(r){var e=new XMLHttpRequest;e.open(d,n),e.withCredentials=!0,e.responseType="json",e.addEventListener("load",t),e.timeout=2e3,e.addEventListener("timeout",function(e){var t,n;i<maxErrorRetries?(i++,o(r)):(console.log("timeout occurred in "+d),(t=document.querySelector("fieldset.popUp"))&&(t.innerHTML=""),(n=document.getElementById("timeout-error-text").cloneNode(1)).classList.remove("hidden"),n.classList.add("popup-title"),t.appendChild(n))}),e.addEventListener("error",function(e){var t,n;i<=maxErrorRetries?(i++,o(r)):((t=document.querySelector("fieldset.popUp"))&&(t.innerHTML=""),(n=document.getElementById("general-error-text").cloneNode(1)).classList.remove("hidden"),n.classList.add("popup-title"),t.appendChild(n),console.log("error occurred in "+d))}),e.send(r)}(e)}function autorepostOnOffUrl(e){var t=document.location.hostname,n=0<t.indexOf("accounts.")?t.indexOf("accounts."):t.indexOf("post.");return["https://",0<n?t.substring(0,n):"","wapi.craigslist.org/web/v8/postings","/"+e,"/autorepost"].join("")}
/* {"sources":{"popUp.js":"d49606ac042441c7fb8652c84fb081d6"}} */